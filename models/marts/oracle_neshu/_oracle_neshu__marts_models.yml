# models/marts/oracle_neshu/_oracle_neshu__marts_models.yml
version: 2

models:
  # COMPANY
  - name: dim_oracle_neshu__company
    description: >
      Dimension client/company enrichie à partir des labels associés (région, secteur, statut, etc.)
      et des informations de localisation.
    columns:
      - name: idcompany
        description: "Identifiant unique de la société"
        tests:
          - not_null
          - unique

      - name: idcompany_type
        description: "ID Type de société (ex : client, fournisseur...)"

      - name: company_code
        description: "Code client"

      - name: company_name
        description: "Nom de la société"

      - name: region
        description: "Région géographique de la société (label REGION)"

      - name: sector
        description: "Secteur d’activité (HORECA/OFFICE) (label SECTEUR_ACTVITE)"

      - name: sector_code
        description: "Code sectoriel associé, lien avec ceux de nespresso (label CODE_SECTEUR)"

      - name: activity_sector
        description: "Secteur d'activité détaillé (label SECTEUR_DACTIVITE)"

      - name: employee_range
        description: "Tranche de collaborateurs (label TRANCHE_COLLAB)"

      - name: company_type
        description: "Type d’entreprise (label TYPECOMPAGNIE)"

      - name: economic_model
        description: "Modèle économique client (label MODELEECOCLIENT)"

      - name: client_status
        description: "Statut client (OR/ARGENT/BRONZE) (label STATUT_CLIENT)"

      - name: is_active
        description: >
          Indique si la société est active (label ISACTIVE). 
          TRUE si 'yes', sinon FALSE.

      - name: key_account
        description: "KA grand compte (label KA)"

      - name: katiers
        description: "Label KATIERS lié au KA"

      - name: remote_work
        description: "Indicateur du nombre de télétravail par semaine (label TELETRAVAIL)"

      - name: proadman
        description: "Nombre de passage roadman (label PROADMAN)"

      - name: gsm
        description: "Gobelet Sucre Melangeur FORMULE (label GSM_TERRAIN)"

      - name: badge
        description: "Indicateur de badge client (label BADGE)"

      - name: recycling
        description: "Indicateur de recyclage (label RECYCLAGE)"

      - name: address1
        description: "Adresse principale (ligne 1)"

      - name: address2
        description: "Adresse complémentaire (ligne 2)"

      - name: city
        description: "Ville de la société"

      - name: postal_code
        description: "Code postal de la société"

      - name: country
        description: "Pays de la société"

      - name: created_at
        description: "Date de création dans la base source"

      - name: updated_at
        description: "Date de dernière mise à jour dans la base source"

  # PRODUCT
  - name: dim_oracle_neshu__product
    description: >
      Dimension produit enrichie à partir des labels associés (type, famille, groupe, marque, etc.)
      et filtrée sur les produits de type 1 (produit) et 5 (ligne de prix).
    columns:
      - name: idproduct
        description: "Identifiant unique du produit"
        tests:
          - not_null
          - unique

      - name: idproduct_type
        description: "Type de produit (1 = produit, 5 = ligne de prix)"

      - name: product_code
        description: "Code produit (référence interne)"

      - name: product_name
        description: "Nom du produit"

      - name: purchase_unit_price
        description: "Prix d'achat unitaire du produit"

      - name: brand
        description: "Marque du produit, extraite du label MARQUEP"

      - name: owner
        description: "Propriétaire du produit, via label PROPRIETAIRE"

      - name: family
        description: "Famille produit (ex : CAFE CAPSULES, THE), via label FAMILLE"

      - name: bio
        description: "Indication BIO ou non (via label BIO)"

      - name: product_group
        description: "Groupe produit (ACCESSOIRES, SNACKING...), via label GROUPE"

      - name: product_type_standard
        description: >
          Typologie produit standardisée selon règles métier :
          ex. 'CAFE CAPS', 'THE', 'CHOCOLATS VAN HOUTEN', 'BOISSONS GOURMANDES'.
  
      - name: is_active
        description: >
          État d'activité du produit, converti en booléen :
          TRUE si le label ISACTIVE = 'YES', sinon FALSE.

      - name: created_at
        description: "Date de création du produit dans la source"

      - name: updated_at
        description: "Date de dernière mise à jour du produit dans la source"

    # DEVICE
  - name: dim_oracle_neshu__device
    description: >
      Dimension device enrichie à partir des labels associés (état, statut, gamme, catégorie, marque, etc.),
      filtrée sur les machines (type 1).
    columns:
      - name: iddevice
        description: "Identifiant unique de la machine"
        tests:
          - not_null
          - unique

      - name: iddevice_type
        description: "Type de machine (1 = machine, autres ignorés ici)"

      - name: idcompany_customer
        description: "Identifiant du client (company) auquel est rattachée la machine"
        tests:
          - not_null
          - relationships:
              to: ref('dim_oracle_neshu__company')
              field: idcompany

      - name: idlocation
        description: "Identifiant de localisation"

      - name: device_code
        description: "Code interne de la machine"

      - name: device_name
        description: "Nom de la machine"

      - name: company_code
        description: "Code client associé à la machine"

      - name: brand
        description: "Marque de la machine (label MARQUE)"

      - name: machine_gamme
        description: "Gamme de la machine (label GAMME)"

      - name: machine_category
        description: "Catégorie de la machine (label CATEGORIE)"

      - name: modele_economique
        description: "Modèle économique de la machine (label MODECOMA)"

      - name: is_active
        description: >
          Indique si la machine est considérée comme active selon le label ISACTIVE.
          TRUE si 'yes', sinon FALSE (converti en booléen).

      - name: access_info
        description: "Informations d'accès au site de la machine (depuis la table location)"

      - name: last_installation_date
        description: "Date de dernière installation de la machine"

      - name: created_at
        description: "Date de création de la machine dans la base source"

      - name: updated_at
        description: "Date de dernière mise à jour de la machine dans la base source"
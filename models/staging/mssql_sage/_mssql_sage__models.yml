version: 2

models:
  - name: stg_mssql_sage__f_ecriturea
    description: "Écritures analytiques nettoyées issues du système MSSQL Sage"
    columns:
      - name: cb_marq
        description: "Identifiant unique de l'écriture analytique"
        tests:
          - unique
          - not_null
      - name: ec_no
        description: "Numéro de l'écriture comptable associée"
        tests:
          - not_null
          - relationships:
              to: ref('stg_mssql_sage__f_ecriturec') 
              field: ec_no                             
      - name: ea_ligne
        description: "Numéro de la ligne dans l'écriture analytique"
      - name: ca_num
        description: "Code analytique"
      - name: ea_montant
        description: "Montant de l'écriture analytique"
      - name: ea_quantite
        description: "Quantité associée"
      - name: cb_createur
        description: "Utilisateur créateur"
      - name: cb_creation_user
        description: "Utilisateur ayant créé l'écriture"
      - name: created_at
        description: "Timestamp de création"
      - name: updated_at
        description: "Timestamp de dernière modification"
      - name: extracted_at
        description: "Timestamp d'extraction"
      - name: deleted_at
        description: "Timestamp de suppression logique"

  - name: stg_mssql_sage__f_ecriturec
    description: "Écritures comptables nettoyées issues du système MSSQL Sage"
    columns:
      - name: ec_no
        description: "Numéro de l'écriture comptable (PK)"
        tests:
          - unique
          - not_null
      - name: cb_marq
        description: "Identifiant unique de l'écriture comptable"
        tests:
          - not_null
      - name: ec_no_link
        description: "Lien vers l'écriture parent, si existant"
      - name: jo_num
        description: "Code du journal"
      - name: cg_num
        description: "Compte général"
      - name: ct_num
        description: "Compte tiers"
      - name: ec_intitule
        description: "Libellé de l'écriture"
      - name: ec_sens
        description: "Sens de l'écriture (1 = débit, 2 = crédit)"
      - name: ec_montant
        description: "Montant de l'écriture"
      - name: ec_montant_regle
        description: "Montant réglé"
      - name: ec_devise
        description: "Code devise"
      - name: n_devise
        description: "Numéro de devise"
      - name: ec_date
        description: "Date de l'écriture comptable"
      - name: jm_date
        description: "Periode de facturation de l'ecriture comptable"
      - name: ec_jour
        description: "Jour de la date de facturation de l'ecriture comptable"
      - name: ec_echeance
        description: "Date d'échéance (NULL si placeholder 1753-01-01)"
      - name: ec_date_rappro
        description: "Date de rapprochement (NULL si placeholder 1753-01-01)"
      - name: ec_date_regle
        description: "Date de règlement (NULL si placeholder 1753-01-01)"
      - name: cb_createur
        description: "Utilisateur créateur"
      - name: cb_creation_user
        description: "Utilisateur ayant créé l'écriture"
      - name: created_at
        description: "Timestamp de création"
      - name: updated_at
        description: "Timestamp de dernière modification"
      - name: extracted_at
        description: "Timestamp d'extraction"
      - name: deleted_at
        description: "Timestamp de suppression logique"

  # TABLE COMPTE NUNSHEN COMMERCE
  - name: stg_mssql_sage__f_comptet
    description: "Table des comptes clients Nunshen nettoyée et transformée depuis la table source dbo_f_comptet de MSSQL Sage"
    columns:
      - name: ct_num
        description: "Code unique du compte client"
        tests:
          - unique
          - not_null
      - name: ct_intitule
        description: "Intitulé ou nom du compte client"
        tests:
          - not_null
      - name: ct_type
        description: "Type de compte client"
      - name: ct_contact
        description: "Nom du contact principal du compte client"
      - name: ct_adresse
        description: "Adresse principale du compte client"
      - name: ct_complement
        description: "Complément d'adresse"
      - name: ct_codepostal
        description: "Code postal du compte client"
      - name: ct_ville
        description: "Ville du compte client"
      - name: ct_pays
        description: "Pays du compte client"
      - name: ct_siret
        description: "Numéro SIRET du compte client"
      - name: ct_numpayeur
        description: "Numéro du payeur associé au compte client"
      - name: co_no
        description: "Code comptable associé au compte client"
      - name: ct_telephone
        description: "Téléphone du compte client"
      - name: ct_email
        description: "Email du compte client"
      - name: categorisation_niv_1
        description: "Catégorisation niveau 1 du compte client"
      - name: categorisation_niv_2
        description: "Catégorisation niveau 2 du compte client"
      - name: categorisation_niv_3
        description: "Catégorisation niveau 3 du compte client"
      - name: ligne_de_service
        description: "Ligne de service associée au compte client"
      - name: annee_origine
        description: "Année d'origine du compte client"
      - name: client_perdu
        description: "Indique si le client est perdu"
      - name: typologie
        description: "Typologie du compte client"
      - name: created_at
        description: "Date de création du compte client (cbCreation)"
      - name: updated_at
        description: "Date de dernière modification du compte client (cbModification)"
      - name: extracted_at
        description: "Timestamp d'extraction depuis la source Meltano (_sdc_extracted_at)"

  # TABLE COLLABORATEUR NUNSHEN COMMERCE
  - name: stg_mssql_sage__f_collaborateur
    description: "Table des collaborateur Nunshen nettoyée et transformée depuis la table source dbo_f_collaborateur de MSSQL Sage"
    columns:
      - name: co_no
        description: "Code unique du collaborateur"
        tests:
          - unique
          - not_null
      - name: co_nom
        description: "Nom du collaborateur"
      - name: co_prenom
        description: "Prénom du collaborateur"
      - name: co_fonction
        description: "Fonction du collaborateur"
      - name: created_at
        description: "Date de création du collaborateur (cbCreation)"
      - name: updated_at
        description: "Date de dernière modification du collaborateur (cbModification)"
      - name: extracted_at
        description: "Timestamp d'extraction depuis la source Meltano (_sdc_extracted_at)"


  # TABLE DOCLIGNE NUNSHEN COMMERCE
  - name: stg_mssql_sage__f_docligne
    description: "Table des docligne Nunshen nettoyée et transformée depuis la table source dbo_f_docligne de MSSQL Sage"
    columns:
      - name: dl_no
        description: "Code unique de de la transaction"
        tests:
          - unique
          - not_null
      - name: cbco_no
        description: "Code du collaborateur associé à la vente"
        relationships:
          - to: ref('stg_mssql_sage__f_collaborateur')
            field: co_no
      - name: ct_num
        description: "Code du compte client associé"
      - name: do_piece
        description: "Pièce associée à la ventes"
      - name: dl_design
        description: "Désignation produit de la ventes"
      - name: ar_ref
        description: "Référence article de la ventes"
      - name: do_date
        description: "Date de la vente"
      - name: dl_qte
        description: "Quantité vendue"
      - name: dl_montant_ht
        description: "Montant HT de la vente"
      - name: dl_montant_ttc
        description: "Montant TTC de la vente"
      - name: dl_prix_unitaire
        description: "Prix unitaire du produit"
      - name: created_at
        description: "Date de création du collaborateur (cbCreation)"
      - name: updated_at
        description: "Date de dernière modification du collaborateur (cbModification)"
      - name: extracted_at
        description: "Timestamp d'extraction depuis la source Meltano (_sdc_extracted_at)"
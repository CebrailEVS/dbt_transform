version: 2

models:
  # ACTIVITE
  - name: stg_nesp_co__activite
    description: "Activite transformés et nettoyés depuis la source Nespresso Commerce Activite"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - activity_id
            - employee_responsible
            - activity_type
    columns:
      - name: employee_responsible
        description: "Identifiant de l'employé responsable"
        tests:
          - not_null
      - name: activity_id
        description: "Identifiant de l'activité commerciale"
        tests:
          - not_null
      - name: c4c_id_commercial
        description: "Id C4C du commercial"
      - name: activity_type
        description: "Type d'activité commerciale (Phone call, appointment, etc.)"
        tests:
          - not_null
      - name: phone_call
        description: "Description de l'appel téléphonique si activity_type = Phone call"
      - name: created_by_phone_call
        description: "Identifiant du commercial responsable de l'appel téléphonique"
      - name: appointment
        description: "Description du rendez-vous si activity_type = appointment"
      - name: created_by_appointment
        description: "Identifiant du commercial responsable du rendez-vous"          
      - name: activity_category
        description: "Catégorie de l'activité commerciale"
      - name: calendar_month
        description: "Mois du calendrier en format texte"
      - name: main_account
        description: "Nom du compte"
      - name: c4c_id_main_account
        description: "ID C4C du nom du compte lié a main_account"
      - name: role 
        description: "Prospect / Client"
      - name: nessoft_id_main_account 
        description: "Identifiant Nessoft du compte principal"
      - name: activity_unit
        description: "Unité de l'activité commerciale"
      - name: activity_life_cycle_status
        description: "Statut du cycle de vie de l'activité commerciale"
      - name: campaign_id_preceding_lead
        description: "Identifiant de la campagne précédant le lead"
      - name: c4c_id_campaign
        description: "ID C4C de la campagne"
      - name: start_date_phone_call
        description: "Date de l'appel téléphonique"
      - name: start_date_appointment
        description: "Date du rendez-vous"
      - name: start_date_task
        description: "Date de la tâche"
      - name: notes
        description: "Notes supplémentaires sur l'activité commerciale"
      - name: extracted_at
        description: "Date et heure d'extraction des données"
      - name: source_file
        description: "Nom du fichier source d'où proviennent les données"
      - name: file_date
        description: "Date du fichier source"

  # OPPORTUNITE
  - name: stg_nesp_co__opportunite
    description: "Opportunités transformés et nettoyés depuis la source Nespresso Commerce Opportunite"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - opportunity_id
            - employee_responsible
            - created_by
    columns:
      - name: opportunity_id
        description: "Identifiant de l'opportunité commerciale"
        tests:
          - not_null
      - name: employee_responsible
        description: "Nom de l'employé responsable"
        tests:
          - not_null
      - name: c4c_id_commercial
        description: "ID C4C du commercial"
      - name: created_by
        description: "Nom du créateur de l'opportunité"
        tests:
          - not_null
      - name: opportunity_name
        description: "Nom de l'opportunite"
      - name: campaign_name
        description: "Nom de la campagne associée à l'opportunité"
      - name: c4c_id_campaign
        description: "ID C4C de la campagne"
      - name: created_on
        description: "Date de création de l'opportunité"
      - name: source
        description: "Source de l'opportunité"
      - name: account_name
        description: "Nom du compte associé à l'opportunité"
      - name: c4c_id_account
        description: "ID C4C du compte"
      - name: reason_for_status
        description: "Raison du statut de l'opportunité"
      - name: close_date
        description: "Date de clôture de l'opportunité"
      - name: calendar_month
        description: "Mois du calendrier en format texte"
      - name: calendar_year
        description: "Année du calendrier"
      - name: nessoft_id_account
        description: "Identifiant Nessoft du compte"
      - name: sales_unit
        description: "Unité de vente associée à l'opportunité"
      - name: role_account
        description: "Rôle du compte (Prospect / Client)"
      - name: lifecycle_status
        description: "Statut du cycle de vie de l'opportunité"
      - name: first_coffee_order
        description: "Nombre de capsules de la première commande de café"
      - name: expected_value
        description: "Valeur attendue de l'opportunité"
      - name: zeq_zenius_equivalent
        description: "Équivalent Zenius de l'opportunité"
      - name: chance_of_success
        description: "Chance de succès de l'opportunité en pourcentage"
      - name: machines_opportunity
        description: "Nombre de machines associées à l'opportunité"
      - name: extracted_at
        description: "Date et heure d'extraction des données"
      - name: source_file
        description: "Nom du fichier source d'où proviennent les données"
      - name: file_date
        description: "Date du fichier source"

  # CLIENT
  - name: stg_nesp_co__client
    description: "Table des bases clients Nespresso EVS nettoyée et filtrée sur les colonnes utiles."
    columns:
      - name: third
        description: "Identifiant unique du client."
        tests:
          - not_null
          - unique

      # Colonnes texte
      - name: third_name
        description: "Nom du client."
      - name: third_adr_ln1
        description: "Adresse du client - ligne 1."
      - name: third_adr_ln2
        description: "Adresse du client - ligne 2."
      - name: third_post_code
        description: "Code postal du client."
      - name: third_city
        description: "Ville du client."
      - name: third_status_descr
        description: "Description du statut du client."
      - name: segmentation_hypercare
        description: "Segmentation du client (SMALL MEDIUM GET)"
      - name: categorie_client
        description: "Catégorie du client."
      - name: region
        description: "Région du client."
      - name: secteur
        description: "Secteur du client."
      - name: code_lmb
        description: "Code LMB du client."
      - name: mb_descr
        description: "Description MB."
      - name: code_mb
        description: "Code MB."
      - name: siret
        description: "Numéro SIRET du client."
      - name: nb_salaries
        description: "Nombre de salariés du client."
      - name: order_placer_name
        description: "Nom du placeur de commande."
      - name: order_placer_adr_ln1
        description: "Adresse du placeur de commande - ligne 1."
      - name: order_placer_post_code
        description: "Code postal du placeur de commande."
      - name: order_placer_city
        description: "Ville du placeur de commande."
      - name: order_placer_phone
        description: "Téléphone du placeur de commande."

      # Dates
      - name: club_dt_disp
        description: "Date d'inscription au club."
      - name: last_caps_ord_dt_disp
        description: "Date du dernier achat de capsules."

      # Mesures
      - name: ns
        description: "Score NS actuel."
      - name: ns_n1
        description: "Score NS annuel N-1."
      - name: ns_n_nytd
        description: "Score NS NYTD."
      - name: ns_n1_nytd
        description: "Score NS N-1 NYTD."
      - name: caps
        description: "Volume de capsules."
      - name: caps_n1
        description: "Volume de capsules N-1."
      - name: caps_n_ytd
        description: "Volume de capsules année en cours."
      - name: caps_n1_ytd
        description: "Volume de capsules N-1 année en cours."
      - name: caps_b2b
        description: "Volume capsules B2B."
      - name: caps_b2c
        description: "Volume capsules B2C."
      - name: caps_b2c_ytd
        description: "Volume capsules B2C année en cours."
      - name: ez
        description: "Volume EZ."
      - name: ez_n_ytd
        description: "Volume EZ année en cours."
      - name: ez_n1
        description: "Volume EZ N-1."

      # Metadata
      - name: _smart_source_bucket
        description: "Bucket source du fichier initial."
      - name: _smart_source_file
        description: "Nom du fichier source."
      - name: _smart_source_lineno
        description: "Numéro de ligne dans le fichier source."
      - name: _sdc_batched_at
        description: "Timestamp de traitement batch."
      - name: _sdc_received_at
        description: "Timestamp de réception initiale par le système."

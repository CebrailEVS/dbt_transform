version: 2

#### REFERENCE POUR MODEL YUMAN  ####

seeds:
  - name: ref_yuman__cp_metropole
    description: "Correspondance codes postaux vers métropoles"
    columns:
      - name: Code_Postal
        description: "Code postal (5 chiffres)"
        tests:
          - not_null
      - name: Metropole
        description: "Nom de la métropole"

  - name: ref_yuman__cp_tech
    description: "Correspondance codes postaux et regions pour les techniciens"
    columns:
      - name: cp_depart_int
        description: "code postal de départ (cedex) - integer"
        tests:
          - not_null
          - unique
      - name: cp_depart_texte
        description: "code postal de départ (cedex) - texte"
        tests:
          - not_null
          - unique
      - name: cp_final_int
        description: "code postal de fin (simplifié) - integer"
        tests:
          - not_null
      - name: cp_final_texte
        description: "code postal de fin (simplifié) - texte"
        tests:
          - not_null
      - name: libelle_cp
        description: "libellé du code postal de fin"
        tests:
          - not_null
      - name: num_departement_texte
        description: "numéro du département - texte (2 chiffres)"
        tests:
          - not_null
      - name: nom_departement
        description: "Nom du département"
        tests:
          - not_null
      - name: region_tech
        description: "Région correspondante pour la sectorisation des techniciens"
        tests:
          - not_null

  - name: ref_yuman__tech_agence
    description: "Mapping entre tech et agence stock"
    columns:
      - name: nom
        description: "nom tech"
        tests:
          - not_null
      - name: prenom
        description: "prénom du tech"
        tests:
          - not_null
      - name: agence
        description: "agence rattaché pour le stock"
        tests:
          - not_null
      - name: equipe
        description: "équipe du technicien"
        tests:
          - not_null

  - name: ref_yuman__dpt_metropole
    description: "Correspondance départements vers métropoles"
    columns:
      - name: Departement
        description: "Numéro de département"
        tests:
          - not_null
      - name: Metropole
        description: "Nom de la métropole"

  - name: ref_yuman__machine_clean
    description: "Mapping noms machines bruts vers standardisés"
    columns:
      - name: Machine_Brut
        description: "Nom machine tel qu'en source"
        tests:
          - not_null
          - unique
      - name: MACHINE
        description: "Nom machine standardisé"
      - name: famille_neshu
        description: "Famille de la machine"
        tests:
          - not_null

  - name: ref_yuman__marque_clean
    description: "Correspondance technicien vers marque"
    columns:
      - name: NOM_DU_TECHNICIEN
        description: "Nom du technicien"
      - name: MARQUE
        description: "Marque associée"

  - name: ref_yuman__technicien_clean
    description: "Référentiel des techniciens et équipes"
    columns:
      - name: TECHNICIEN
        description: "Format 'prénom nom'"
        tests:
          - not_null
      - name: EQUIPE
        description: "Équipe d'affectation"
        tests:
          - not_null

  - name: ref_yuman__type_inter_clean
    description: "Mapping types d'interventions"
    columns:
      - name: Type_intervention_Brut
        description: "Type intervention source"
      - name: TYPE_INTER
        description: "Type intervention standardisé"

  - name: ref_yuman__tarification_clean
    description: "Grille tarifaire complète"
    columns:
      - name: KEY
        description: "Clé de tarification composite"
        tests:
          - not_null
      - name: Montant
        description: "Montant en euros"
        tests:
          - not_null
      - name: PROD
        description: "Indicateur production"

#### REFERENCE POUR MODEL ORACLE NESHU  ####

  - name: ref_oracle_neshu__valo_parc_machine
    description: "Fichier de référence (machine -> valorisation unitaire)."
    columns:
      - name: machine_modele
        description: "Identifiant / libellé du modèle de machine."
      - name: montant_inv
        description: "Valorisation unitaire (format texte ou numérique selon l'import)."

  - name: ref_oracle_neshu__roadman_gea
    description: "Mapping code roadman NESHU vers GEA"
    columns:
      - name: roadman_code
        description: "Code roadman NESHU"
        tests:
          - not_null
      - name: gea_code
        description: "Code GEA associé"
        tests:
          - not_null

  - name: ref_oracle_neshu__groupement_machine
    description: "Mapping nom machine vers groupement machine pour valorisation parc"
    columns:
      - name: device_name
        description: "Nom de la machine"
        tests:
          - not_null
      - name: device_group
        description: "Groupement machine associé."
        tests:
          - not_null

  - name: ref_oracle_neshu__valo_machine_capacite
    description: "Fichier de référence pour le groupe de machine animo grain modulo et la quantité maximal de produit associé"
    columns:
      - name: product_code
        description: "Code produit"
        tests:
          - not_null
      - name: quantite
        description: "Quantité que peut contenir la machine pour le produit associé"
        tests:
          - not_null
      - name: device_group
        description: "Groupement machine associé."
        tests:
          - not_null

#### REFERENCE POUR MODEL MSSQL SAGE  ####

  - name: ref_mssql_sage__code_analytique_bu
    description: "Mapping code analytique vers description"
    columns:
      - name: code_analytique
        description: "Code de la section analytique"
        tests:
          - not_null
      - name: code_analytique_bu
        description: "BU associé au code analytique"

  - name: ref_mssql_sage__code_comptable_bu
    description: "Mapping compte comptable vers BU"
    config:
      column_types:
        code_comptable: string
    columns:
      - name: code_comptable
        description: "Numéro de compte général"
        tests:
          - not_null
          - unique
      - name: designation_compte
        description: "Désignation du compte comptable"
        tests:
          - not_null
      - name: macro_categorie_pnl_bu
        description: "Macro catégorie P&L BU associée au compte comptable"

#### REFERENCE GENERAL ####

  - name: ref_general__feries_metropole
    description: "Liste des jours fériés en métropole"
    columns:
      - name: annee
        description: "Année"
        tests:
          - not_null
      - name: mois
        description: "Mois"
        tests:
          - not_null
      - name: date_ferie
        description: "Date du jour férié"
        tests:
          - not_null
      - name: nom_jour_ferie
        description: "Nom du jour férié"
        tests:
          - not_null


#### REFERENCE TECHNIQUE NESPRESSO (FACTURATION ET PRIMES)

  - name: ref_nesp_tech__key_type_inter
    description: "Table de référence des types d'intervention techniques"
    columns:
      - name: type_code
        description: "Code du type d'intervention"
        tests:
          - not_null

      - name: repair_code_1
        description: "Code réparation (NULL = toutes valeurs)"

      - name: failure_code
        description: "Code panne (NULL = toutes valeurs)"

      - name: mini_prev_bool
        description: "Indique une mini préventive (TRUE/FALSE)"

      - name: type_machine
        description : "Categorie Machine"

      - name: type_inter_libelle
        description: "Libellé du type d'intervention"
        tests:
          - not_null


  - name: ref_nesp_tech__machines_clean
    description: "Table de normalisation des noms de machines"
    columns:
      - name: nom_machine
        description: "Nom machine brut"
        tests:
          - not_null
          - unique

      - name: categorie_machine
        description: "Catégorie de machine"

      - name: machine_clean
        description: "Nom machine standardisé"
        tests:
          - not_null


  - name: ref_nesp_tech__dpts_montagne_factu
    description: "Départements considérés comme zone montagne pour la facturation"
    columns:
      - name: dpt
        description: "Code département"
        tests:
          - not_null
          - unique

      - name: montagne
        description: "Indicateur zone montagne (1 = oui, 0 = non)"
        tests:
          - not_null


  - name: ref_nesp_tech__cps_montagne_primes
    description: "Codes postaux considérés comme zone montagne pour le calcul des primes"
    columns:
      - name: cp
        description: "Code postal"
        tests:
          - not_null
          - unique

      - name: montagne
        description: "Indicateur zone montagne (1 = oui, 0 = non)"
        tests:
          - not_null

  - name: ref_nesp_tech__key_facturation
    description: "Clé de facturation des interventions techniques"
    columns:
      - name: type_code
        description: "Code intervention"

      - name: type_inter
        description: "Type d'intervention (Curative / Préventive)"

      - name: machine_clean
        description: "Machine normalisée"
        tests:
          - not_null

      - name: montagne_factu
        description: "Suffixe potentiel selon montagne"

      - name: key_ref_inter
        description: "Clé de facturation lisible"
        tests:
          - not_null

      - name: key_factu
        description: "Clé de facturation lisible"
        tests:
          - not_null

      - name: prod_factu
        description: "Prod associee a l'intervention"
        tests:
          - not_null

      - name: tarif_factu
        description: "Tarif de l'intervention"
        tests:
          - not_null

  - name: ref_nesp_tech__articles_prix
    description: "Référentiel des articles techniques avec prix unitaires"
    columns:
      - name: article_ref_nomad
        description: "Référence interne NOMAD de l'article"
        tests:
          - not_null
          - unique

      - name: article_desc
        description: "Description de l'article"

      - name: article_ref_cordon
        description: "Référence CORDON associée à l'article"

      - name: article_prix_unitaire
        description: "Prix unitaire de l'article"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " >= 0"